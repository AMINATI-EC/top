// ====================================
// sprites.js - キャラクタードット絵
// ====================================

const SPRITES = {
    // カラーパレット
    colors: {
        // 肌色
        skin: '#ffdbac',
        skinShadow: '#e8b88a',
        // 髪色バリエーション
        hairBlack: '#2a2a2a',
        hairBrown: '#5c4033',
        hairLight: '#8b6914',
        // コンビニ制服（青系）
        uniform: '#1e88e5',
        uniformDark: '#1565c0',
        uniformLight: '#42a5f5',
        // エプロン
        apron: '#43a047',
        apronDark: '#2e7d32',
        // その他
        white: '#ffffff',
        black: '#000000',
        red: '#e53935',
        gray: '#757575',
    },

    // 32x32 男性店員A（真面目系）- 顔のみ
    staffMaleA: {
        width: 32,
        height: 32,
        // _ = 透明, 数字 = colors配列のインデックス
        palette: ['#2a2a2a', '#ffdbac', '#e8b88a', '#ffffff', '#000000', '#d32f2f', '#1e88e5'],
        //         0:黒髪    1:肌     2:肌影    3:白目   4:黒目    5:赤(頬)  6:制服青
        data: [
            '________________________________',
            '________________________________',
            '_________00000000000____________',
            '________0000000000000___________',
            '_______000000000000000__________',
            '_______000000000000000__________',
            '______00000000000000000_________',
            '______00000000000000000_________',
            '______00000000000000000_________',
            '______00000000000000000_________',
            '_______0000000000000000_________',
            '_______0011111111111100_________',
            '______011111111111111110________',
            '______111111111111111111________',
            '_____11111111111111111111_______',
            '_____11113331111133111111_______',
            '_____11113431111134311111_______',
            '_____11113331111133311111_______',
            '_____11111111111111111111_______',
            '______1111111111111111111_______',
            '______1115111111111151111_______',
            '______1111111111111111111_______',
            '_______111111122111111111_______',
            '_______111111111111111111_______',
            '________1111112211111111________',
            '________11111111111111__________',
            '_________111111111111___________',
            '__________1111111111____________',
            '___________11111111_____________',
            '___________66666666_____________',
            '__________6666666666____________',
            '________________________________',
        ],
    },

    // 32x32 女性店員A（元気系）- 顔のみ
    staffFemaleA: {
        width: 32,
        height: 32,
        palette: ['#5c4033', '#ffdbac', '#e8b88a', '#ffffff', '#000000', '#ff8a80', '#e53935', '#1e88e5'],
        //         0:茶髪    1:肌     2:肌影    3:白目   4:黒目    5:頬ピンク 6:リボン赤 7:制服
        data: [
            '________________________________',
            '___________666666_______________',
            '__________66666666______________',
            '_________0000000000_____________',
            '________000000000000____________',
            '_______00000000000000___________',
            '_______00000000000000___________',
            '______0000000000000000__________',
            '______0000000000000000__________',
            '______0000000000000000__________',
            '_____000000000000000000_________',
            '_____000111111111110000_________',
            '_____001111111111111000_________',
            '____01111111111111111100________',
            '____11111111111111111110________',
            '____11113331111133111110________',
            '____11113431111134311110________',
            '____11113331111133311110________',
            '____11111111111111111110________',
            '_____1115111111111511110________',
            '_____1111111111111111110________',
            '_____1111111221111111100________',
            '______111111111111111100________',
            '______111111122111111100________',
            '_______11111111111111100________',
            '________111111111111100_________',
            '_________1111111111100__________',
            '__________11111111100___________',
            '___________111111100____________',
            '___________77777777_____________',
            '__________7777777777____________',
            '________________________________',
        ],
    },

    // 32x32 男性店員B（マイペース系）- 顔のみ
    staffMaleB: {
        width: 32,
        height: 32,
        palette: ['#8b6914', '#ffdbac', '#e8b88a', '#ffffff', '#000000', '#d32f2f', '#1e88e5'],
        //         0:明るい髪 1:肌     2:肌影    3:白目   4:黒目    5:赤      6:制服
        data: [
            '________________________________',
            '________________________________',
            '__________0000000000____________',
            '_________000000000000___________',
            '________00000000000000__________',
            '________00000000000000__________',
            '_______0000000000000000_________',
            '_______00000000000000000________',
            '_______00000000000000000________',
            '________0000000000000000________',
            '________0001111111110000________',
            '________0111111111111100________',
            '_______01111111111111110________',
            '_______11111111111111111________',
            '______1111111111111111111_______',
            '______1111333111133311111_______',
            '______1111343111134311111_______',
            '______1111333111133311111_______',
            '______1111111111111111111_______',
            '_______111111111111111111_______',
            '_______111111111111111111_______',
            '_______111111112211111111_______',
            '________11111111111111111_______',
            '________11111112211111111_______',
            '_________1111111111111111_______',
            '__________11111111111111________',
            '___________111111111111_________',
            '____________1111111111__________',
            '_____________11111111___________',
            '____________6666666666__________',
            '___________666666666666_________',
            '________________________________',
        ],
    },

    // 32x32 女性店員B（しっかり者）- 顔のみ
    staffFemaleB: {
        width: 32,
        height: 32,
        palette: ['#2a2a2a', '#ffdbac', '#e8b88a', '#ffffff', '#000000', '#ff8a80', '#1e88e5', '#4a4a4a'],
        //         0:黒髪    1:肌     2:肌影    3:白目   4:黒目    5:頬     6:制服   7:髪ハイライト
        data: [
            '________________________________',
            '________00000000000000__________',
            '_______0000000000000000_________',
            '______000007000070000000________',
            '______000000000000000000________',
            '_____00000000000000000000_______',
            '_____00000000000000000000_______',
            '_____00000000000000000000_______',
            '_____00000000000000000000_______',
            '_____00001111111111100000_______',
            '_____00111111111111110000_______',
            '_____01111111111111111000_______',
            '____0111111111111111111100______',
            '____0111111111111111111100______',
            '____0111133311113331111100______',
            '____0111134311113431111100______',
            '____0111133311113331111100______',
            '____0111111111111111111100______',
            '_____011151111111115111100______',
            '_____011111111111111111100______',
            '_____011111112211111111100______',
            '______0111111111111111100_______',
            '______0111111122111111100_______',
            '_______01111111111111100________',
            '________0111111111111100________',
            '_________011111111111100________',
            '__________0111111111100_________',
            '___________01111111100__________',
            '____________66666666____________',
            '___________6666666666___________',
            '__________666666666666__________',
            '________________________________',
        ],
    },

    // スプライトをCanvasに描画する関数
    drawSprite(ctx, spriteName, x, y, scale = 1) {
        const sprite = this[spriteName];
        if (!sprite) return;

        const { width, height, palette, data } = sprite;

        for (let row = 0; row < height; row++) {
            const line = data[row];
            for (let col = 0; col < width; col++) {
                const char = line[col];
                if (char === '_') continue; // 透明

                const colorIndex = parseInt(char, 10);
                if (isNaN(colorIndex) || !palette[colorIndex]) continue;

                ctx.fillStyle = palette[colorIndex];
                ctx.fillRect(x + col * scale, y + row * scale, scale, scale);
            }
        }
    },

    // スプライトをキャッシュ用Canvasとして生成
    createSpriteCanvas(spriteName, scale = 2) {
        const sprite = this[spriteName];
        if (!sprite) return null;

        const canvas = document.createElement('canvas');
        canvas.width = sprite.width * scale;
        canvas.height = sprite.height * scale;

        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;

        this.drawSprite(ctx, spriteName, 0, 0, scale);

        return canvas;
    },

    // 全スプライトのキャッシュを生成
    cache: {},
    
    initCache(scale = 2) {
        const spriteNames = ['staffMaleA', 'staffFemaleA', 'staffMaleB', 'staffFemaleB'];
        spriteNames.forEach(name => {
            this.cache[name] = this.createSpriteCanvas(name, scale);
        });
    },

    // キャッシュから描画
    drawCached(ctx, spriteName, x, y) {
        const cached = this.cache[spriteName];
        if (cached) {
            ctx.drawImage(cached, x, y);
        }
    },
};
